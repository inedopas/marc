<?xml version="1.0" encoding="utf-8"?>
<modification>
	<name>Related / Dependent options</name>
	<version><![CDATA[2.4.4]]></version>
	<author>ITcraft | support@conceptlogic.ru</author>
	<link>http://erpshop.ru/packages</link>
	<code><![CDATA[Related Options]]></code>
	<file path="admin/controller/catalog/product.php">
		<operation error="log">
			<search index="0"><![CDATA['required'             => $product_option['required']]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			'master_option'             => $product_option['master_option'],
			'master_option_data'		=> $master_option_data,
			//EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search index="1"><![CDATA['required'             => $product_option['required']]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			'master_option'             => $product_option['master_option'],
			'master_option_data'		=> isset($product_option['master_option_data']) ? $product_option['master_option_data'] : array(),
			'master_option_value'		=> isset($product_option['master_option_value']) ? $product_option['master_option_value'] : 0,
			//EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA['weight_prefix'           => $product_option_value['weight_prefix']]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			'master_option_value'             => $product_option_value['master_option_value'],
			//EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[if (isset($this->error['warning'])) {]]></search>
			<add position="before"><![CDATA[//BOF Related Options

			//text
			$this->load->language('catalog/related_options');
			$data['entry_master_option'] = $this->language->get('entry_master_option');
			$data['entry_master_option_value'] = $this->language->get('entry_master_option_value');

			//EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[if (isset($product_option['product_option_value'])) {]]></search>
			<add position="before"><![CDATA[//BOF Related Options
				$master_option_data = array();
				if (isset($product_option['master_option_data'])) {
					$master_option_data = $product_option['master_option_data'];
				} else {
					if (!empty($product_option['master_option'])) {
						foreach ($product_options as $product_option1) {
							if ($product_option1['option_id'] == $product_option['master_option']) {
								foreach ($product_option1['product_option_value'] as $key_option => $val_option) {
									$option_name = $this->model_catalog_option->getOptionValue($val_option['option_value_id']);
									$product_option1['product_option_value'][$key_option]['name'] = $option_name['name'];
								}
								$master_option_data = $product_option1;
							}
						}
					}
				}

			  if ($product_option['type'] == 'select' || $product_option['type'] == 'radio' || $product_option['type'] == 'checkbox' || $product_option['type'] == 'image') {
			  // EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['option_values'] = array();]]></search>
			<add position="before"><![CDATA[//BOF Related Options
						 else {
				$data['product_options'][] = array(
					'product_option_id' => $product_option['product_option_id'],
					'option_id'         => $product_option['option_id'],
					'name'              => $product_option['name'],
					'type'              => $product_option['type'],
					'value'      => $product_option['value'],
					//BOF Related Options
					'master_option'             => $product_option['master_option'],
					'master_option_data'		=> $master_option_data,
					'master_option_value'		=> isset($product_option['master_option_value']) ? $product_option['master_option_value'] : 0,
					//EOF Related Options
					'required'          => $product_option['required']
				);
			}
		}
		// EOF Related Options]]></add>
		</operation>
	</file>
	<file path="admin/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA[foreach ($data['product_option'] as $product_option) {]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			$previous_product_option_id = 0;
			// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$product_option_id = $this->db->getLastId();]]></search>
			<add position="after"><![CDATA[//BOF Related Options
			$this->db->query("UPDATE " . DB_PREFIX . "product_option SET master_option = '" . (int)$product_option['master_option'] . "' WHERE product_option_id = '" . $product_option_id . "'");
			// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[value = '" . $this->db->escape($product_option['value']) . "', required = '" . (int)$product_option['required'] . "'")]]></search>
			<add position="after"><![CDATA[//BOF Related Options
			$product_option_id = $this->db->getLastId();
			$this->db->query("UPDATE " . DB_PREFIX . "product_option SET master_option = '" . (int)$product_option['master_option'] . "', master_option_value = '" . (int)$product_option['master_option_value'] . "' WHERE product_option_id = '" . $this->db->getLastId() . "'");
			// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA["', weight_prefix = '" . $this->db->escape($product_option_value['weight_prefix']) . "'");]]></search>
			<add position="after" index="1"><![CDATA[//BOF Related Options
			if ((int)$product_option['master_option']) {
				$this->db->query("UPDATE " . DB_PREFIX . "product_option_value SET master_option_value = '" . (int)$product_option_value['master_option_value'] . "' WHERE product_option_value_id = '" . $this->db->getLastId() . "'");
			}
			// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[=> $product_option['required']]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			'master_option'             => $product_option['master_option'],
			'master_option_value'       => $product_option['master_option_value'],
			'master_option_data'        => $this->getProductOption($product_id, $product_option['master_option']),
			// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA['weight_prefix'           => $product_option_value['weight_prefix']]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			'master_option_value'             => $product_option_value['master_option_value'],
			// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[public function getProductImages($product_id)]]></search>
			<add position="before" offset="1"><![CDATA[//BOF Related Options
			public function getProductOption($product_id, $option_id) {
				$product_option_data = array();

				$product_option_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_option po LEFT JOIN `" . DB_PREFIX . "option` o ON (po.option_id = o.option_id) LEFT JOIN " . DB_PREFIX . "option_description od ON (o.option_id = od.option_id) WHERE po.product_id = '" . (int)$product_id . "' AND od.language_id = '" . (int)$this->config->get('config_language_id') . "' AND po.option_id = '" . (int)$option_id . "' ORDER BY o.sort_order");

				$product_option = $product_option_query->row;
				if ($product_option) {
					if ($product_option['type'] == 'select' || $product_option['type'] == 'radio' || $product_option['type'] == 'checkbox' || $product_option['type'] == 'image') {
						$product_option_value_data = array();

						$product_option_value_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "product_option_value pov LEFT JOIN " . DB_PREFIX . "option_value ov ON (pov.option_value_id = ov.option_value_id) LEFT JOIN " . DB_PREFIX . "option_value_description ovd ON (ov.option_value_id = ovd.option_value_id) WHERE pov.product_option_id = '" . (int)$product_option['product_option_id'] . "' AND ovd.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY ov.sort_order");

						foreach ($product_option_value_query->rows as $product_option_value) {
							$parent_name = '';
							if ($product_option_value['master_option_value'] > 0) {
								$master_value_query = $this->db->query("SELECT * FROM " . DB_PREFIX . "option_value_description WHERE option_value_id = '" . (int)$product_option_value['master_option_value'] . "' AND language_id = '" . (int)$this->config->get('config_language_id') . "'");
								$parent_name = ' ('.$master_value_query->row['name'].')';
							}
							$product_option_value_data[] = array(
								'product_option_value_id' => $product_option_value['product_option_value_id'],
								'option_value_id'         => $product_option_value['option_value_id'],
								'name'                    => $product_option_value['name'] . $parent_name,
								'image'                   => $product_option_value['image'],
								'quantity'                => $product_option_value['quantity'],
								'subtract'                => $product_option_value['subtract'],
								'price'                   => $product_option_value['price'],
								'price_prefix'            => $product_option_value['price_prefix'],
								'points'                  => $product_option_value['points'],
								'points_prefix'           => $product_option_value['points_prefix'],
								'weight'                  => $product_option_value['weight'],
								'weight_prefix'           => $product_option_value['weight_prefix']
							);
						}

						$product_option_data = array(
							'product_option_id'    => $product_option['product_option_id'],
							'option_id'            => $product_option['option_id'],
							'name'                 => $product_option['name'],
							'type'                 => $product_option['type'],
							'product_option_value' => $product_option_value_data,
							'required'             => $product_option['required']
						);
					} else {
						$product_option_data = array(
							'product_option_id' => $product_option['product_option_id'],
							'option_id'         => $product_option['option_id'],
							'name'              => $product_option['name'],
							'type'              => $product_option['type'],
							'option_value'      => $product_option['value'],
							'required'          => $product_option['required']
						);
					}
				}

				return $product_option_data;
			}
			// EOF Related Options]]></add>
		</operation>
	</file>
	<file path="admin/view/*/catalog/product_form.tpl">
		<operation error="log">
			<search index="0"><![CDATA[<?php foreach ($product_options as $product_option) { ?>]]></search>
			<add position="before"><![CDATA[					  <!--BOF Related Options-->
					<?php
					usort($product_options, function($a, $b) {
						return $a['option_id'] - $b['option_id'];
					});
					?>
						<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<?php if ($product_option['type'] == 'text') { ?>]]></search>
			<add position="before"><![CDATA[					  <!--BOF Related Options-->
						<div class="form-group">
							<label class="col-sm-2 control-label"><?php echo $entry_master_option; ?></label>
							<div class="col-sm-10">
								<select name="product_option[<?php echo $option_row; ?>][master_option]" class="form-control">
									<option value="0"><?php echo $text_no; ?></option>
									<?php foreach ($product_options as $product_option1) { ?>
										<?php if ($product_option1['type'] != 'select' and $product_option1['type'] != 'radio' and $product_option1['type'] != 'checkbox' and $product_option1['type'] != 'image') continue; ?>
										<?php if ($product_option1['option_id'] != $product_option['option_id']) { ?>
											<?php if ($product_option1['option_id'] == $product_option['master_option']) { ?>
												<option value="<?php echo $product_option1['option_id']; ?>" selected="selected"><?php echo $product_option1['name']; ?></option>
											<?php } else { ?>
												<option value="<?php echo $product_option1['option_id']; ?>"><?php echo $product_option1['name']; ?></option>
											<?php } ?>
										<?php } ?>
									<?php } ?>
								</select>
							</div>
						</div>
						<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<?php if ($product_option['type'] == 'text') { ?>]]></search>
			<add position="after"><![CDATA[	<!--BOF Related Options-->
						<div class="form-group">
							<label class="col-sm-2 control-label"><?php echo $entry_master_option_value; ?></label>
							<div class="col-sm-10 col-master-<?php echo $option_row; ?>" data-col="<?php echo $option_row; ?>" data-row="0">
								<?php if ($product_option['master_option']) { ?>
									<select name="product_option[<?php echo $option_row; ?>][master_option_value]" value="<?php echo $product_option['value']; ?>" class="form-control">
										<option value="0"><?php echo $text_no; ?></option>
										<?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
											<?php if ($master_option_value['option_value_id'] == $product_option['master_option_value']) { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>" selected="selected"><?php echo $master_option_value['name']; ?></option>
											<?php } else { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
											<?php } ?>
										<?php } ?>
									</select>
								<?php } else { ?>
									- <input type="hidden" name="product_option[<?php echo $option_row; ?>][master_option_value]" value="0">
								<?php }?>
							</div>
						</div>
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<?php if ($product_option['type'] == 'textarea') { ?>]]></search>
			<add position="after"><![CDATA[	<!--BOF Related Options-->
						<div class="form-group">
							<label class="col-sm-2 control-label"><?php echo $entry_master_option_value; ?></label>
							<div class="col-sm-10 col-master-<?php echo $option_row; ?>" data-col="<?php echo $option_row; ?>" data-row="0">
								<?php if ($product_option['master_option']) { ?>
									<select name="product_option[<?php echo $option_row; ?>][master_option_value]" value="<?php echo $product_option['option_value']; ?>" class="form-control">
										<option value="0"><?php echo $text_no; ?></option>
										<?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
											<?php if ($master_option_value['option_value_id'] == $product_option['master_option_value']) { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>" selected="selected"><?php echo $master_option_value['name']; ?></option>
											<?php } else { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
											<?php } ?>
										<?php } ?>
									</select>
								<?php } else { ?>
									- <input type="hidden" name="product_option[<?php echo $option_row; ?>][master_option_value]" value="0">
								<?php }?>
							</div>
						</div>
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<?php if ($product_option['type'] == 'file') { ?>]]></search>
			<add position="after"><![CDATA[	<!--BOF Related Options-->
						<div class="form-group">
							<label class="col-sm-2 control-label"><?php echo $entry_master_option_value; ?></label>
							<div class="col-sm-10 col-master-<?php echo $option_row; ?>" data-col="<?php echo $option_row; ?>" data-row="0">
								<?php if ($product_option['master_option']) { ?>
									<select name="product_option[<?php echo $option_row; ?>][master_option_value]" value="<?php echo $product_option['option_value']; ?>" class="form-control">
										<option value="0"><?php echo $text_no; ?></option>
										<?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
											<?php if ($master_option_value['option_value_id'] == $product_option['master_option_value']) { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>" selected="selected"><?php echo $master_option_value['name']; ?></option>
											<?php } else { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
											<?php } ?>
										<?php } ?>
									</select>
								<?php } else { ?>
									- <input type="hidden" name="product_option[<?php echo $option_row; ?>][master_option_value]" value="0">
								<?php }?>
							</div>
						</div>
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<?php if ($product_option['type'] == 'date') { ?>]]></search>
			<add position="after"><![CDATA[	<!--BOF Related Options-->
						<div class="form-group">
							<label class="col-sm-2 control-label"><?php echo $entry_master_option_value; ?></label>
							<div class="col-sm-10 col-master-<?php echo $option_row; ?>" data-col="<?php echo $option_row; ?>" data-row="0">
								<?php if ($product_option['master_option']) { ?>
									<select name="product_option[<?php echo $option_row; ?>][master_option_value]" value="<?php echo $product_option['option_value']; ?>" class="form-control">
										<option value="0"><?php echo $text_no; ?></option>
										<?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
											<?php if ($master_option_value['option_value_id'] == $product_option['master_option_value']) { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>" selected="selected"><?php echo $master_option_value['name']; ?></option>
											<?php } else { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
											<?php } ?>
										<?php } ?>
									</select>
								<?php } else { ?>
									- <input type="hidden" name="product_option[<?php echo $option_row; ?>][master_option_value]" value="0">
								<?php }?>
							</div>
						</div>
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<?php if ($product_option['type'] == 'time') { ?>]]></search>
			<add position="after"><![CDATA[	<!--BOF Related Options-->
						<div class="form-group">
							<label class="col-sm-2 control-label"><?php echo $entry_master_option_value; ?></label>
							<div class="col-sm-10 col-master-<?php echo $option_row; ?>" data-col="<?php echo $option_row; ?>" data-row="0">
								<?php if ($product_option['master_option']) { ?>
									<select name="product_option[<?php echo $option_row; ?>][master_option_value]" value="<?php echo $product_option['option_value']; ?>" class="form-control">
										<option value="0"><?php echo $text_no; ?></option>
										<?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
											<?php if ($master_option_value['option_value_id'] == $product_option['master_option_value']) { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>" selected="selected"><?php echo $master_option_value['name']; ?></option>
											<?php } else { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
											<?php } ?>
										<?php } ?>
									</select>
								<?php } else { ?>
									- <input type="hidden" name="product_option[<?php echo $option_row; ?>][master_option_value]" value="0">
								<?php }?>
							</div>
						</div>
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<?php if ($product_option['type'] == 'datetime') { ?>]]></search>
			<add position="after"><![CDATA[	<!--BOF Related Options-->
						<div class="form-group">
							<label class="col-sm-2 control-label"><?php echo $entry_master_option_value; ?></label>
							<div class="col-sm-10 col-master-<?php echo $option_row; ?>" data-col="<?php echo $option_row; ?>" data-row="0">
								<?php if ($product_option['master_option']) { ?>
									<select name="product_option[<?php echo $option_row; ?>][master_option_value]" value="<?php echo $product_option['option_value']; ?>" class="form-control">
										<option value="0"><?php echo $text_no; ?></option>
										<?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
											<?php if ($master_option_value['option_value_id'] == $product_option['master_option_value']) { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>" selected="selected"><?php echo $master_option_value['name']; ?></option>
											<?php } else { ?>
												<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
											<?php } ?>
										<?php } ?>
									</select>
								<?php } else { ?>
									- <input type="hidden" name="product_option[<?php echo $option_row; ?>][master_option_value]" value="0">
								<?php }?>
							</div>
						</div>
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[html += '        <td class="text-right"><?php echo $entry_weight; ?></td>';]]></search>
			<add position="replace"><![CDATA[	<!--BOF Related Options-->
							  html += '        <td class="text-right relate-option"><?php echo $entry_weight; ?></td>';
							  <!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<td class="text-right"><?php echo $entry_weight; ?></td>]]></search>
			<add position="after"><![CDATA[<!--BOF Related Options-->
							  <td class="text-right"><?php echo $entry_master_option_value; ?></td>
							  <!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<td colspan="6"></td>]]></search>
			<add position="replace" index="1"><![CDATA[<td colspan="7"></td>]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[<input type="text" name="product_option[<?php echo $option_row; ?>][product_option_value][<?php echo $option_value_row; ?>][weight]" value="<?php echo $product_option_value['weight']; ?>" placeholder="<?php echo $entry_weight; ?>" class="form-control" /></td>]]></search>
			<add position="after"><![CDATA[<!--BOF Related Options-->
								<td class="right col-master-<?php echo $option_row; ?>" data-col="<?php echo $option_row; ?>" data-row="<?php echo $option_value_row; ?>">
									<?php if ($product_option['master_option']) { ?>
										<select name="product_option[<?php echo $option_row; ?>][product_option_value][<?php echo $option_value_row; ?>][master_option_value]" class="form-control">
											<?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
												<option value="0"><?php echo $text_no; ?></option>
												<?php if ($master_option_value['option_value_id'] == $product_option_value['master_option_value']) { ?>
													<option value="<?php echo $master_option_value['option_value_id']; ?>" selected="selected"><?php echo $master_option_value['name']; ?></option>
												<?php } else { ?>
													<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
												<?php } ?>
											<?php } ?>
										</select>
									<?php } else { ?>
										<center>-</center>
										<input type="hidden" name="product_option[<?php echo $option_row; ?>][product_option_value][<?php echo $option_value_row; ?>][master_option_value]" value="0">
									<?php }?>
								</td>
								<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[<select id="option-values<?php echo $option_row; ?>" style="display: none;">]]></search>
			<add position="before"><![CDATA[						<!--BOF Related Options-->
			<?php if ($product_option['master_option']) { ?>
			<select id="master-option-values<?php echo $option_row; ?>" style="display: none;" class="form-control">
              <?php foreach ($product_option['master_option_data']['product_option_value'] as $master_option_value) { ?>
              	<option value="<?php echo $master_option_value['option_value_id']; ?>"><?php echo $master_option_value['name']; ?></option>
              <?php } ?>
            </select>
            <?php } ?>
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[if (item['type'] == 'text') {]]></search>
			<add position="before"><![CDATA[		<!--BOF Related Options-->
			html += '	  <div class="form-group">';
			html += '		<label class="col-sm-2 control-label"><?php echo $entry_master_option; ?></label>';
			html += '       <div class="col-sm-10"><select name="product_option[' + option_row + '][master_option]" class="form-control">';
			html += '	    <option value="0"><?php echo $text_no; ?></option>';
			$('input[name$="[option_id]"]').each(function() {
                var name = $(this).attr('name').split('][');
                var num = name[0].split('[');
                num = num[1];
                html += '<option value="'+ $(this).val() +'">'+ $('input[name="product_option[' + num + '][name]"]').val() +'</option>';
            });
			html += '	    </select></div>';
			html += '     </div>';

			if (item['type'] != 'select' && item['type'] != 'radio' && item['type'] != 'checkbox' && item['type'] != 'image') {
	            html += '	<div class="form-group">';
	            html += '	  <label class="col-sm-2 control-label" for="input-value' + option_row + '"><?php echo $entry_master_option_value; ?></label>';
	            html += '	  <div class="col-sm-10 col-master-' + option_row +'" data-col="' + option_row +'" data-row="0">- <input type="hidden" name="product_option[' + option_row + '][master_option_value]" value="0"></div>';
	            html += '	</div>';
	        }
			<!--EOF Related Options-->]]>
			</add>
		</operation>
		<operation error="log">
			<search><![CDATA[html += '        <td class="text-right relate-option"><?php echo $entry_weight; ?></td>';]]></search>
			<add position="after"><![CDATA[	<!--BOF Related Options-->
							  html += '        <td class="text-right"><?php echo $entry_master_option_value; ?></td>';
							  <!--EOF Related Options-->]]>
			</add>
		</operation>


		<operation error="log">
			<search><![CDATA[html  = '<div class="tab-pane" id="tab-option' + option_row + '">';]]></search>
			<add position="before"><![CDATA[
				if (item['type'] == 'select' || item['type'] == 'radio' || item['type'] == 'checkbox' || item['type'] == 'image') {
					$('select[name$="[master_option]"]').append('<option value="'+ item['value'] +'">'+ item['label'] +'</option>');
	            }
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[html += '  <input type="text" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][weight]" value="" placeholder="<?php echo $entry_weight; ?>" class="form-control" /></td>';]]></search>
			<add position="after"><![CDATA[
				<!--BOF Related Options-->
				if ($('#master-option-values' + option_row).size() > 0) {
					html += '    <td class="right col-master-' + option_row +'" data-col="' + option_row +'" data-row="' + option_value_row +'"><select name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][master_option_value]">';
					html += $('#master-option-values' + option_row).html();
					html += '    </select></td>';
				} else {
					html += '<td class="right col-master-' + option_row +'" data-col="' + option_row +'" data-row="' + option_value_row +'"><center>-</center><input type="hidden" name="product_option[' + option_row + '][product_option_value][' + option_value_row + '][master_option_value]" value="0"></td>';
				}
				<!--EOF Related Options-->
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[onclick="$('a[href=\'#tab-option<?php echo $option_row; ?>\']').parent().remove(); $('#tab-option<?php echo $option_row; ?>').remove(); $('#option a:first').tab('show');"]]></search>
			<add position="replace" trim="true"><![CDATA[
				onclick="master_option_del(<?php echo $option_row; ?>); $('a[href=\'#tab-option<?php echo $option_row; ?>\']').parent().remove(); $('#tab-option<?php echo $option_row; ?>').remove(); $('#option a:first').tab('show');"
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[onclick="$(this).tooltip('destroy');$('#option-value-row<?php echo $option_value_row; ?>').remove();"]]></search>
			<add position="replace" trim="true"><![CDATA[
				onclick="$(this).tooltip('destroy');$('#option-value-row<?php echo $option_value_row; ?>').remove(); master_option_ch(<?php echo $option_row; ?>);"
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[onclick=" $(\'#option a:first\').tab(\'show\');$(\'a[href=\\\'#tab-option' + option_row + '\\\']\').parent().remove(); $(\'#tab-option' + option_row + '\').remove();"]]></search>
			<add position="replace" trim="true"><![CDATA[
				onclick="master_option_del(' + option_row + '); $(\'#option a:first\').tab(\'show\');$(\'a[href=\\\'#tab-option' + option_row + '\\\']\').parent().remove(); $(\'#tab-option' + option_row + '\').remove();"
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[onclick="$(this).tooltip(\'destroy\');$(\'#option-value-row' + option_value_row + '\').remove();"]]></search>
			<add position="replace" trim="true"><![CDATA[
				onclick="$(this).tooltip(\'destroy\');$(\'#option-value-row' + option_value_row + '\').remove(); master_option_ch('+option_row+');"
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$('[rel=tooltip]').tooltip();]]></search>
			<add position="after"><![CDATA[
				master_option(option_row, option_value_row);
			    master_option_ch(option_row);
			]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[var option_value_row = <?php echo $option_value_row; ?>;]]></search>
			<add position="before"><![CDATA[
				function master_option(option_num, row, selected) {
				    var id = $('select[name="product_option['+ option_num  +'][master_option]"]').val();
                    var type = $('input[name="product_option['+ option_num  +'][type]"]').val();

				    if (id == 0) {
				        $('.col-master-' + option_num).each(function() {
				            if (typeof(row) == 'undefined' || row == $(this).data('row')) {
                                if (type == 'select' || type == 'radio' || type == 'checkbox' || type == 'image') {
                                    $(this).html('<center>-</center><input type="hidden" name="product_option[' + $(this).data('col') + '][product_option_value][' + $(this).data('row') + '][master_option_value]" value="0">');
                                } else {
                                    $(this).html('- <input type="hidden" name="product_option[' + $(this).data('col') + '][master_option_value]" value="0">');
                                }
				            }
				        });
				    } else {
				        $('.col-master-' + option_num).each(function() {
				            if (typeof(row) == 'undefined' || row == $(this).data('row')) {
                                if (type == 'select' || type == 'radio' || type == 'checkbox' || type == 'image') {
                                    var select = '<select class="form-control" name="product_option[' + $(this).data('col') + '][product_option_value][' + $(this).data('row') + '][master_option_value]">';
                                } else {
                                    var select = '<select class="form-control" name="product_option[' + $(this).data('col') + '][master_option_value]">';
                                }
				                select += '<option value="0">---</option>';
				                var name_opt = $('input[name$="[option_id]"][value='+ id +']').attr('name').split('][');
				                var num_opt = name_opt[0].split('[');
				                num_opt = num_opt[1];
								var type_val = $('input[name="product_option['+ num_opt  +'][type]"]').val();
                                if (type_val == 'select' || type_val == 'radio' || type_val == 'checkbox' || type_val == 'image') {
                                    $('select[name^="product_option['+ num_opt +'][product_option_value]"][name$="[option_value_id]"]').each(function() {
                                        var parent_opt_name = $(this).parent().parent().find('select[name^="product_option['+ num_opt +'][product_option_value]"][name$="[master_option_value]"]').find('option:selected').text();
										if (parent_opt_name!='') {
											parent_opt_name = ' ('+ parent_opt_name +')';
										}
    				                    select += '<option value="'+ $(this).val() +'" '+ ((typeof(selected) != 'undefined' && selected == $(this).val()) ? ' selected="selected"' : '') +'>'+ $(this).find('option:selected').text() + parent_opt_name +'</option>';
    				                });
                                } else {
                                    $('input[name="product_option['+ num_opt +'][value]"]').each(function() {
    				                    select += '<option value="'+ $(this).val() +'" '+ ((typeof(selected) != 'undefined' && selected == $(this).val()) ? ' selected="selected"' : '') +'>'+ $(this).val() +'</option>';
    				                });
                                }
				                select += '</select>';
				                $(this).html(select);
				            }
				        });
				    }
				}
				$('#form-product').delegate('select[name$="[master_option]"]', "change", function() {
				    var name = $(this).attr('name').split('][');
				    var num = name[0].split('[');
				    master_option(num[1]);
				});

				function master_option_ch(option_row) {
				    var option_id = $('input[name="product_option['+ option_row +'][option_id]"]').val();
				    $('select[name$="[master_option]"]').each(function() {
				        if ($(this).val() == option_id) {
				            var name_1 = $(this).attr('name').split('][');
				            var num_1 = name_1[0].split('[');

				            $('.col-master-' + num_1[1]).each(function() {
				                master_option($(this).data('col'), $(this).data('row'), $(this).find('select').val());
				            });
				        }
				    });
				}
				function master_option_del(option_row) {
				    var option_id = $('input[name="product_option['+ option_row +'][option_id]"]').val();
				    $('select[name$="[master_option]"]').each(function() {
				        if ($(this).val() == option_id) {
				            $(this).val(0);
				            var name_1 = $(this).attr('name').split('][');
				            var num_1 = name_1[0].split('[');
				            $('.col-master-' + num_1[1]).each(function() {
				                master_option($(this).data('col'));
				            });
				        }
						$(this).find('option[value='+ option_id +']').remove();
				    });
				}
				$('#form-product').delegate('select[name$="[option_value_id]"]', "change", function() {
				    var name = $(this).attr('name').split('][');
				    var num = name[0].split('[');
				    master_option_ch(num[1]);
				});
			]]></add>
		</operation>
	</file>

	<file path="catalog/controller/product/{product,quickview}.php">
		<operation error="log">
			<search><![CDATA['required'             => $option['required']]]></search>
			<add position="before"><![CDATA[					//BOF Related Options
					'master_option'          => $option['master_option'],
					// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA['price_prefix'            => $option_value['price_prefix']]]></search>
			<add position="before"><![CDATA[//BOF Related Options
						  'master_option_value'     => $option_value['master_option_value'],
						  // EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[foreach ($this->model_catalog_product->getProductOptions($this->request->get['product_id']) as $option) {]]></search>
			<add position="after"><![CDATA[//BOF Related Options
						  if ($option['type'] == 'select' || $option['type'] == 'radio' || $option['type'] == 'checkbox' || $option['type'] == 'image') {
						  // EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[if ($product_info['minimum']) {]]></search>
			<add position="before"><![CDATA[//BOF Related Options
						  elseif ($option['type'] == 'text' || $option['type'] == 'textarea' || $option['type'] == 'file' || $option['type'] == 'date' || $option['type'] == 'datetime' || $option['type'] == 'time') {
					$data['options'][] =array(
						'product_option_id' => $option['product_option_id'],
						'option_id'         => $option['option_id'],
						'name'              => $option['name'],
						'type'              => $option['type'],
						'value'      => $option['value'],
						//BOF Related Options
						'master_option'          => $option['master_option'],
						'master_option_value'    => $option['master_option_value'],
						// EOF Related Options
						'required'          => $option['required']
					);
				}
			}
						  // EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$product_option_value_data = array();]]></search>
			<add position="after"><![CDATA[//BOF Related Options
			$related_options = $this->config->get('related_options');
				if (isset($related_options['residue_on']) && $related_options['residue_on']) {
					foreach ($option['product_option_value'] as $option_value) {
						if ((($this->config->get('config_customer_price') && $this->customer->isLogged()) || !$this->config->get('config_customer_price')) && (float)$option_value['price']) {
							$price = $this->currency->format($this->tax->calculate($option_value['price'], $product_info['tax_class_id'], $this->config->get('config_tax') ? 'P' : false), $this->session->data['currency']);
						} else {
							$price = false;
						}

						$product_option_value_data[] = array(
							'product_option_value_id' => $option_value['product_option_value_id'],
							'option_value_id'         => $option_value['option_value_id'],
							'name'                    => $option_value['name'],
							'image'                   => $this->model_tool_image->resize($option_value['image'], 50, 50),
							'price'                   => $price,
							//BOF Related Options
							'master_option_value'     => $option_value['master_option_value'],
							'quantity'     			  => $option_value['quantity'],
							// EOF Related Options
							'price_prefix'            => $option_value['price_prefix']
						);
					}
				} else {
						  		  // EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['options'][] = array(]]></search>
			<add position="before" index="0"><![CDATA[//BOF Related Options
			}
			 // EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[$data['text_loading'] = $this->language->get('text_loading');]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			$data['decimal_point'] = $this->language->get('decimal_point');
			$data['thousand_point'] = $this->language->get('thousand_point');
			$related_options = $this->config->get('related_options');
			$data['related_options'] = $related_options;
			// EOF Related Options]]></add>
		</operation>
	</file>

	<file path="catalog/model/catalog/product.php">
		<operation error="log">
			<search><![CDATA['weight_prefix'           => $product_option_value['weight_prefix']]]></search>
			<add position="before"><![CDATA[//BOF Related Options
			'master_option_value'             => $product_option_value['master_option_value'],
			// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA['required'             => $product_option['required']]]></search>
			<add position="before"><![CDATA[				//BOF Related Options
				'master_option'          => $product_option['master_option'],
				// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[foreach ($product_option_query->rows as $product_option) {]]></search>
			<add position="after"><![CDATA[				//BOF Related Options
				if ($product_option['type'] == 'select' || $product_option['type'] == 'radio' || $product_option['type'] == 'checkbox' || $product_option['type'] == 'image') {
				// EOF Related Options]]></add>
		</operation>
		<operation error="log">
			<search><![CDATA[return $product_option_data;]]></search>
			<add position="before"><![CDATA[				//BOF Related Options
				else {
				$product_option_data[] = array(
					'product_option_id' => $product_option['product_option_id'],
					'option_id'         => $product_option['option_id'],
					'name'              => $product_option['name'],
					'type'              => $product_option['type'],
					'value'      => $product_option['value'],
					//BOF Related Options
					'master_option'          => $product_option['master_option'],
					'master_option_value'    => $product_option['master_option_value'],
					// EOF Related Options
					'required'          => $product_option['required']
				);
			}
		}
				// EOF Related Options]]></add>
		</operation>
	</file>
</modification>